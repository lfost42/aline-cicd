# AWS LB Controller - Create ClusterRole, ClusterRoleBinding & ServiceAccount
# kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/master/docs/examples/rbac-role.yaml
# aws iam create-policy \
#     --policy-name AWSLoadBalancerControllerIAMPolicy \
#     --policy-document file://iam_policy_latest.json

# eksctl create iamserviceaccount \
#   --cluster=lf-aline \
#   --namespace=kube-system \
#   --name=aws-load-balancer-controller \
#   --attach-policy-arn=arn:aws:iam::052911266688:policy/AWSLoadBalancerControllerIAMPolicy \
#   --override-existing-serviceaccounts \
#   --region us-west-1 \
#   --approve

# allow incoming traffic on TCP 443 on k8s control plane for webhook access

# kubectl apply -k "github.com/aws/eks-charts/stable/aws-load-balancer-controller//crds?ref=master"
# helm install aws-load-balancer-controller eks/aws-load-balancer-controller -n kube-system --set clusterName=lf-aline --set serviceAccount.create=false --set serviceAccount.name=aws-load-balancer-controller

helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
    --set clusterName=lf-aline \
    --set serviceAccount.create=false \
    --set region=us-west-1 \
    --set vpcId=vpc-01fac557e86febc0e \
    --set serviceAccount.name=aws-load-balancer-controller \
    -n kube-system

kubectl apply -f manifest/frontend/

# helm uninstall aws-load-balancer-controller -n kube-system

# verify domains are mapping:
curl -i -H "Host: admin.alinefinancial.com" http://a2de8ecf5edac43a284d9636c22c945e-1261427252.us-west-1.elb.amazonaws.com
curl -i -H "Host: alinefinancial.com" http://a5f23b5a274af4219aa5e02c7f850d90-1766176637.us-west-1.elb.amazonaws.com
curl -i -H "Host: api.alinefinancial.com" http://a5f23b5a274af4219aa5e02c7f850d90-1766176637.us-west-1.elb.amazonaws.com
curl -i -H "Host: member.alinefinancial.com" http://a40c7f8b237c44e94b8fac42f2525063-1040091005.us-west-1.elb.amazonaws.com


https://www.nslookup.io/domains/a6df187fe347e4fd9baf1b63f9af4f41-1116982610.us-west-1.elb.amazonaws.com/dns-records/
https://www.nslookup.io/domains/a4721d6fee5304b99ab7cbf5aee45be0-824721020.us-west-1.elb.amazonaws.com /dns-records/
https://www.nslookup.io/a558fc717c9ae49f78492499b48f96b6-1612955429.us-west-1.elb.amazonaws.com/dns-records/
13.57.90.93 admin.alinefinancial.com
52.9.167.253 admin.alinefinancial.com
52.8.184.6 alinefinancial.com
52.52.104.225 alinefinancial.com
52.9.39.5 member.alinefinancial.com
204.236.169.113 member.alinefinancial.com

https://www.nslookup.io/ad8ee5ccc9fa54adf9306173a5f561f8-638432117.us-west-1.elb.amazonaws.com/dns-records/
52.9.89.22 api.alinefinancial.com
18.144.104.194 api.alinefinancial.com